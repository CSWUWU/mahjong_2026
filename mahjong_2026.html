<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 È∫ªÂ∞áÁµ±Ë®àË°®</title>
    
    <!-- Mobile Web App Config -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#fdfbf7">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        milk: {
                            50: '#fdfbf7',
                            100: '#f7f1e3', // Â•∂Ê≥°ÁôΩ
                            200: '#efe0c7', // Ê∑∫Â•∂Ëå∂
                            300: '#e5cdaa',
                            400: '#dcb88e', // Á∂ìÂÖ∏Â•∂Ëå∂
                            500: '#d4a373', // ÁÑ¶Á≥ñ
                            600: '#b08968', // Ê∑±ÁÉòÁÑô
                            700: '#7f5539', // ÂíñÂï°Ë±Ü
                            800: '#5c4033', // ÊøÉÁ∏Æ
                            900: '#4a3429',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-milk-50 text-milk-800 font-sans min-h-screen safe-area-pb">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ÂúñÁ§∫ÁµÑ‰ª∂
        const Icons = {
            Plus: () => <i data-lucide="plus" className="w-4 h-4"></i>,
            Trash2: () => <i data-lucide="trash-2" className="w-4 h-4"></i>,
            Download: () => <i data-lucide="download" className="w-4 h-4"></i>,
            Upload: () => <i data-lucide="upload" className="w-4 h-4"></i>,
            Trophy: () => <i data-lucide="trophy" className="w-5 h-5"></i>,
            TrendingDown: () => <i data-lucide="trending-down" className="w-5 h-5"></i>,
            Wallet: () => <i data-lucide="wallet" className="w-5 h-5"></i>,
            Calendar: () => <i data-lucide="calendar" className="w-4 h-4"></i>,
            MapPin: () => <i data-lucide="map-pin" className="w-4 h-4"></i>,
            Hash: () => <i data-lucide="hash" className="w-4 h-4"></i>,
            Coins: () => <i data-lucide="coins" className="w-4 h-4"></i>
        };

        const App = () => {
            // --- State ---
            const [records, setRecords] = useState([]);
            const [formData, setFormData] = useState({
                date: new Date().toISOString().split('T')[0],
                stakes: '30/10',
                location: '',
                rounds: '',
                amount: ''
            });

            // --- Effects ---
            
            // ÂàùÂßãÂåñÔºöÂæû localStorage ËÆÄÂèñ
            useEffect(() => {
                const savedData = localStorage.getItem('mahjong_records_2026');
                if (savedData) {
                    try {
                        setRecords(JSON.parse(savedData));
                    } catch (e) {
                        console.error("ËÆÄÂèñÂ§±Êïó", e);
                    }
                }
                lucide.createIcons();
            }, []);

            // Áõ£ËÅΩ records ËÆäÊõ¥‰∏¶Â≠òÊ™î
            useEffect(() => {
                localStorage.setItem('mahjong_records_2026', JSON.stringify(records));
                lucide.createIcons();
            }, [records]);

            // --- Ë®àÁÆóÁµ±Ë®àÊï∏Êìö ---
            const stats = useMemo(() => {
                return records.reduce((acc, curr) => {
                    const amt = Number(curr.amount);
                    acc.net += amt;
                    if (amt > 0) acc.wins += amt;
                    if (amt < 0) acc.losses += Math.abs(amt);
                    acc.rounds += Number(curr.rounds) || 0;
                    return acc;
                }, { net: 0, wins: 0, losses: 0, rounds: 0 });
            }, [records]);

            // --- Handlers ---

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!formData.amount || !formData.date) return;

                const newRecord = {
                    id: Date.now().toString(),
                    ...formData,
                    amount: Number(formData.amount),
                    rounds: Number(formData.rounds)
                };

                setRecords([newRecord, ...records]); // Êñ∞ÁöÑÊéíÂâçÈù¢
                
                // ÈáçÁΩÆË°®ÂñÆÔºå‰øùÁïôÊó•ÊúüÂíåÂú∞ÈªûÊñπ‰æøÈÄ£Á∫åËº∏ÂÖ•
                setFormData(prev => ({
                    ...prev,
                    rounds: '',
                    amount: ''
                }));
            };

            const handleDelete = (id) => {
                if(confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÁ≠ÜÁ¥ÄÈåÑÂóéÔºü')) {
                    setRecords(records.filter(r => r.id !== id));
                }
            };

            const handleExport = () => {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(records));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", `mahjong_2026_backup_${new Date().toISOString().split('T')[0]}.json`);
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            };

            const handleImport = (event) => {
                const fileReader = new FileReader();
                fileReader.readAsText(event.target.files[0], "UTF-8");
                fileReader.onload = e => {
                    try {
                        const parsedData = JSON.parse(e.target.result);
                        if (Array.isArray(parsedData)) {
                            if(confirm('ÂåØÂÖ•Â∞áÊúÉË¶ÜËìãÁõÆÂâçÁöÑÁ¥ÄÈåÑÔºàËã• ID ÈáçË§áÔºâÔºåÁ¢∫ÂÆöÂåØÂÖ•ÂóéÔºüÂª∫Ë≠∞ÂÖàÂÇô‰ªΩ„ÄÇ')) {
                                setRecords(parsedData);
                                alert('ÂåØÂÖ•ÊàêÂäüÔºÅ');
                            }
                        } else {
                            alert('Ê†ºÂºèÈåØË™§ÔºöÊ™îÊ°àÂÖßÂÆπÂøÖÈ†àÊòØ JSON Èô£Âàó');
                        }
                    } catch (err) {
                        alert('Ê™îÊ°àËß£ÊûêÂ§±Êïó');
                    }
                };
            };

            const formatMoney = (num) => {
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            };

            // --- UI Components ---

            const StatCard = ({ title, value, icon: Icon, colorClass, subColorClass }) => (
                <div className={`p-4 rounded-xl shadow-sm border border-milk-200 bg-white flex items-center space-x-4`}>
                    <div className={`p-3 rounded-full ${subColorClass}`}>
                        <Icon />
                    </div>
                    <div>
                        <p className="text-sm text-milk-600 font-medium">{title}</p>
                        <p className={`text-2xl font-bold ${colorClass}`}>
                            {value >= 0 && title !== 'Á∏ΩËº∏' ? '$' : '-$'}{formatMoney(value)}
                        </p>
                    </div>
                </div>
            );

            return (
                <div className="max-w-4xl mx-auto p-4 md:p-8 pb-24">
                    {/* Header */}
                    <div className="flex justify-between items-center mb-8">
                        <div>
                            <h1 className="text-3xl font-bold text-milk-800 tracking-tight">2026 È∫ªÂ∞áÁµ±Ë®àË°®</h1>
                            <p className="text-milk-600 mt-1 text-sm">Á•ùÊÇ®ÊâãÊ∞£‰∫®ÈÄöÔºåÊääÊääËá™Êë∏ üÄÑ</p>
                        </div>
                        <div className="flex gap-2">
                            <button 
                                onClick={handleExport}
                                className="flex items-center gap-2 px-4 py-2 bg-milk-200 text-milk-800 rounded-lg hover:bg-milk-300 transition-colors text-sm font-medium"
                            >
                                <Icons.Download /> ÂåØÂá∫
                            </button>
                            <label className="flex items-center gap-2 px-4 py-2 bg-milk-200 text-milk-800 rounded-lg hover:bg-milk-300 transition-colors text-sm font-medium cursor-pointer">
                                <Icons.Upload /> ÂåØÂÖ•
                                <input type="file" onChange={handleImport} className="hidden" accept=".json" />
                            </label>
                        </div>
                    </div>

                    {/* Stats Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                        <StatCard 
                            title="ÁõÆÂâçÊ∑®Âà©" 
                            value={stats.net} 
                            icon={Icons.Wallet}
                            colorClass={stats.net >= 0 ? 'text-green-600' : 'text-red-500'}
                            subColorClass={stats.net >= 0 ? 'bg-green-50 text-green-600' : 'bg-red-50 text-red-500'}
                        />
                        <StatCard 
                            title="Á∏ΩË¥èÈáëÈ°ç" 
                            value={stats.wins} 
                            icon={Icons.Trophy}
                            colorClass="text-milk-800"
                            subColorClass="bg-milk-100 text-milk-600"
                        />
                        <StatCard 
                            title="Á∏ΩËº∏ÈáëÈ°ç" 
                            value={stats.losses} 
                            icon={Icons.TrendingDown}
                            colorClass="text-milk-800"
                            subColorClass="bg-milk-100 text-milk-600"
                        />
                    </div>

                    {/* Input Form */}
                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-milk-200 mb-8">
                        <h2 className="text-lg font-bold text-milk-800 mb-4 flex items-center gap-2">
                            <Icons.Plus /> Êñ∞Â¢ûÊà∞Á∏æ
                        </h2>
                        <form onSubmit={handleSubmit} className="grid grid-cols-2 md:grid-cols-6 gap-4">
                            <div className="col-span-2 md:col-span-1">
                                <label className="block text-xs font-bold text-milk-600 mb-1">Êó•Êúü</label>
                                <input 
                                    type="date" 
                                    name="date"
                                    required
                                    value={formData.date}
                                    onChange={handleInputChange}
                                    className="w-full p-2 rounded-lg border border-milk-300 focus:outline-none focus:ring-2 focus:ring-milk-400 bg-milk-50"
                                />
                            </div>
                            
                            <div className="col-span-1">
                                <label className="block text-xs font-bold text-milk-600 mb-1">Â∫ïÊ≥®</label>
                                <select 
                                    name="stakes"
                                    value={formData.stakes}
                                    onChange={handleInputChange}
                                    className="w-full p-2 rounded-lg border border-milk-300 focus:outline-none focus:ring-2 focus:ring-milk-400 bg-milk-50"
                                >
                                    <option value="30/10">30/10</option>
                                    <option value="50/20">50/20</option>
                                    <option value="100/20">100/20</option>
                                    <option value="200/50">200/50</option>
                                    <option value="300/100">300/100</option>
                                </select>
                            </div>

                            <div className="col-span-1">
                                <label className="block text-xs font-bold text-milk-600 mb-1">Â∞áÊï∏</label>
                                <input 
                                    type="number" 
                                    name="rounds"
                                    placeholder="ex: 2"
                                    step="0.5"
                                    value={formData.rounds}
                                    onChange={handleInputChange}
                                    className="w-full p-2 rounded-lg border border-milk-300 focus:outline-none focus:ring-2 focus:ring-milk-400 bg-milk-50"
                                />
                            </div>

                            <div className="col-span-2">
                                <label className="block text-xs font-bold text-milk-600 mb-1">Âú∞Èªû</label>
                                <input 
                                    type="text" 
                                    name="location"
                                    placeholder="ex: Â∞èÊòéÂÆ∂"
                                    value={formData.location}
                                    onChange={handleInputChange}
                                    className="w-full p-2 rounded-lg border border-milk-300 focus:outline-none focus:ring-2 focus:ring-milk-400 bg-milk-50"
                                />
                            </div>

                            <div className="col-span-2 md:col-span-1">
                                <label className="block text-xs font-bold text-milk-600 mb-1">Ëº∏Ë¥èÈáëÈ°ç</label>
                                <input 
                                    type="number" 
                                    name="amount"
                                    required
                                    placeholder="+Ë¥è / -Ëº∏"
                                    value={formData.amount}
                                    onChange={handleInputChange}
                                    className={`w-full p-2 rounded-lg border border-milk-300 focus:outline-none focus:ring-2 focus:ring-milk-400 bg-milk-50 font-bold ${formData.amount > 0 ? 'text-green-600' : formData.amount < 0 ? 'text-red-500' : ''}`}
                                />
                            </div>
                            
                            <div className="col-span-2 md:col-span-6 flex justify-end">
                                <button type="submit" className="w-full md:w-auto px-6 py-2 bg-milk-500 text-white rounded-lg hover:bg-milk-600 transition-colors font-bold shadow-sm">
                                    Êñ∞Â¢ûÁ¥ÄÈåÑ
                                </button>
                            </div>
                        </form>
                    </div>

                    {/* Data Table */}
                    <div className="bg-white rounded-2xl shadow-sm border border-milk-200 overflow-hidden">
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm text-left">
                                <thead className="bg-milk-100 text-milk-700 font-bold">
                                    <tr>
                                        <th className="p-4 whitespace-nowrap">Êó•Êúü</th>
                                        <th className="p-4 whitespace-nowrap">Â∫ïÊ≥®</th>
                                        <th className="p-4 whitespace-nowrap">Âú∞Èªû</th>
                                        <th className="p-4 whitespace-nowrap text-center">Â∞áÊï∏</th>
                                        <th className="p-4 whitespace-nowrap text-right">Ëº∏Ë¥è</th>
                                        <th className="p-4 whitespace-nowrap text-center">Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-milk-100">
                                    {records.length === 0 ? (
                                        <tr>
                                            <td colSpan="6" className="p-8 text-center text-milk-400">
                                                ÁõÆÂâçÊ≤íÊúâÁ¥ÄÈåÑÔºåÈñãÂßãÊâìÁâåÂêßÔºÅ
                                            </td>
                                        </tr>
                                    ) : (
                                        records.map((record) => (
                                            <tr key={record.id} className="hover:bg-milk-50 transition-colors">
                                                <td className="p-4 text-milk-800">{record.date}</td>
                                                <td className="p-4 text-milk-600">
                                                    <span className="bg-milk-100 px-2 py-1 rounded text-xs">{record.stakes}</span>
                                                </td>
                                                <td className="p-4 text-milk-800">{record.location || '-'}</td>
                                                <td className="p-4 text-center text-milk-800">{record.rounds || '-'}</td>
                                                <td className={`p-4 text-right font-bold ${record.amount >= 0 ? 'text-green-600' : 'text-red-500'}`}>
                                                    {record.amount > 0 ? '+' : ''}{formatMoney(record.amount)}
                                                </td>
                                                <td className="p-4 text-center">
                                                    <button 
                                                        onClick={() => handleDelete(record.id)}
                                                        className="text-milk-400 hover:text-red-500 transition-colors"
                                                        title="Âà™Èô§"
                                                    >
                                                        <Icons.Trash2 />
                                                    </button>
                                                </td>
                                            </tr>
                                        ))
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div className="mt-8 text-center text-xs text-milk-400">
                        2026 Mahjong Tracker ‚Ä¢ Data saved locally
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>